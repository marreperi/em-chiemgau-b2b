{% comment %}
  Section: Download Grid
  Beschreibung: Zeigt eine Grid-Übersicht aus Download-Kacheln (Bild + Titel/Größe + Link).
  Autor: EM-Chiemgau (custom)
{% endcomment %}

<section class="dl-wrap" style="--dl-gap: {{ section.settings.gap | default: 16 }}px; --dl-radius: {{ section.settings.radius | default: 10 }}px; --dl-bg: {{ section.settings.title_bg }}; --dl-color: {{ section.settings.title_color }};">
  {% if section.settings.heading != blank %}
    <h2 class="dl-heading">{{ section.settings.heading }}</h2>
  {% endif %}

  <div class="dl-grid">
    {% for block in section.blocks %}
      {% assign img = block.settings.image %}
      {% assign href = block.settings.file_url %}
      {% assign title = block.settings.title %}
      {% assign size = block.settings.size %}
      <div class="dl-card" {{ block.shopify_attributes }}>
        {% if href != blank %}
          <a class="dl-link" href="{{ href }}" {% if block.settings.new_tab %}target="_blank" rel="noopener"{% endif %} aria-label="{{ title | escape }}">
        {% endif %}
            <div class="dl-thumb">
              {% if img != blank %}
                {{ img | image_url: width: 800 | image_tag:
                  loading: 'lazy',
                  widths: '400,600,800',
                  sizes: '(min-width:1200px) 25vw, (min-width:900px) 33vw, (min-width:600px) 50vw, 100vw',
                  alt: title | escape
                }}
              {% else %}
                <div class="dl-thumb--placeholder" role="img" aria-label="{{ title | default: 'Download' | escape }}"></div>
              {% endif %}
            </div>
            <div class="dl-title">
              {% if title != blank %}
                <span>{{ title }}</span>
              {% else %}
                <span>Download</span>
              {% endif %}
              {% if size != blank %}
                <span class="dl-size">({{ size }})</span>
              {% endif %}
            </div>
        {% if href != blank %}
          </a>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</section>

<style>
  .dl-wrap { width: 100%; }
  .dl-heading { margin: 0 0 12px; font-size: clamp(18px, 3vw, 28px); line-height: 1.2; }
  .dl-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);   /* Handy */
    gap: var(--dl-gap);
  }
  @media (min-width: 600px) {
    .dl-grid { grid-template-columns: repeat(2, 1fr); } /* Tablet hoch */
  }
  @media (min-width: 900px) {
    .dl-grid { grid-template-columns: repeat(3, 1fr); } /* Tablet quer */
  }
  @media (min-width: 1200px) {
    .dl-grid { grid-template-columns: repeat(4, 1fr); } /* Desktop: 4 Spalten */
  }

  .dl-card {
    border-radius: var(--dl-radius);
    overflow: hidden;
    background: #fff;
    box-shadow: 0 2px 6px rgba(0,0,0,.08);
    transition: transform .2s ease;
  }
  .dl-card:hover { transform: translateY(-3px); }

  .dl-link { display: block; color: inherit; text-decoration: none; }

  .dl-thumb {
    position: relative;
    width: 100%;
    aspect-ratio: 4 / 3;           /* gleichmäßige Höhe, kompakt auf Mobil */
    overflow: hidden;
    background: #f2f2f2;
  }
  .dl-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
  .dl-thumb--placeholder { width: 100%; height: 100%; background: repeating-linear-gradient(45deg,#eee,#eee 10px,#f6f6f6 10px,#f6f6f6 20px); }

  .dl-title {
    background: var(--dl-bg);
    color: var(--dl-color);
    padding: 10px;
    text-align: center;
    line-height: 1.25;
    font-size: clamp(12px, 2vw, 14px);
    display: grid;
    grid-auto-flow: column;
    justify-content: center;
    align-items: center;
    gap: .35em;
  }
  .dl-size { opacity: .9; }
</style>

{% schema %}
{
  "name": "Download-Grid",
  "class": "section-download-grid",
  "settings": [
    { "type": "text", "id": "heading", "label": "Überschrift", "default": "Broschüren" },
    { "type": "color", "id": "title_bg", "label": "Titel-Hintergrund", "default": "#6c4b2f" },
    { "type": "color", "id": "title_color", "label": "Titel-Farbe", "default": "#ffffff" },
    { "type": "range", "id": "gap", "label": "Abstand zwischen Kacheln (px)", "min": 8, "max": 32, "step": 1, "default": 16 },
    { "type": "range", "id": "radius", "label": "Eckenradius Karten (px)", "min": 0, "max": 24, "step": 1, "default": 10 }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Kachel",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Cover-Bild (empf. 800×600, WebP)" },
        { "type": "text", "id": "title", "label": "Titel", "default": "Download Broschüre EM im Garten" },
        { "type": "url", "id": "file_url", "label": "Datei-Link (URL aus Inhalt → Dateien)" },
        { "type": "text", "id": "size", "label": "Dateigröße (optional)", "placeholder": "z. B. 7,4 MB" },
        { "type": "checkbox", "id": "new_tab", "label": "In neuem Tab öffnen", "default": true }
      ]
    }
  ],
  "max_blocks": 48,
  "presets": [
    {
      "name": "Download-Grid",
      "category": "Abschnitte",
      "blocks": [
        { "type": "item" },
        { "type": "item" },
        { "type": "item" },
        { "type": "item" }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}{% endstylesheet %}
{% javascript %}{% endjavascript %}